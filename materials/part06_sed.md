# Bash-скрипты, часть 6: sed и обработка текстов
### Лирическое отступление - конвейер в bash
Pipe (конвейер) – это однонаправленный канал межпроцессного взаимодействия. Конвейеры чаще всего используются в shell-скриптах для связи нескольких команд путем перенаправления вывода одной команды (stdout) на вход (stdin) последующей, используя символ конвеера ‘|’:
```shell
cmd1 | cmd2 | .... | cmdN
```

Например:
```shell
index=$(echo $arg | cut -f1 -d=)
val=$(echo $arg | cut -f2 -d=)
```

Команда cut используется, если нужно вырезать часть текста. Ключ f задаёт перечень полей для вырезания. Ключ d устанавливает разделитель между полями.

Таким образом, если в переменной arg, находится, например, строка "X=45", то в переменную index запишется -- X, а в val -- 45.

Также, с помощью конвеера, можно удобно отсортировать массив, полученный в результате предыдущей команды.

### Основы работы с sed
Утилиту sed называют потоковым текстовым редактором. Sed позволяет редактировать потоки данных, основываясь на заданных разработчиком наборах правил. Вот как выглядит схема вызова этой команды:
```shell
sed options file
```

По умолчанию sed применяет указанные при вызове правила, выраженные в виде набора команд, к STDIN. Это позволяет передавать данные непосредственно sed. Например, так:
```shell
echo "This is a test" |
sed 's/test/another test/'
```

В данном случае sed заменяет слово «test» в строке, переданной для обработки, словами «another test». В нашем случае применена команда вида s/pattern1/pattern2/. Буква «s» — это сокращение слова «substitute» — команда замены. Sed, выполняя эту команду, просмотрит переданный текст и заменит найденные в нём фрагменты, соответствующие pattern1, на pattern2.

Для выполнения нескольких действий с данными, используйте ключ -e при вызове sed. Например, вот как организовать замену двух фрагментов текста:
```shell
sed -e 's/This/That/; s/test/another test/'
```

sed также имеет команды для удобной обработки массивов, например оставить лишь определённое кол-во элементов, или расставить номера элементов.

### Выбор фрагментов текста для обработки
Приведём ещё один пример. В некоторых случаях с помощью sed надо обработать лишь какую-то часть текста — некую конкретную строку или группу строк. Для достижения такой цели можно задать ограничение на номера обрабатываемых строк.

Содержимое myfile:
```
This is a test.
This is the second test.
This is the thrid test.
This is the fourth test.
```

Рассмотрим пример, предусматривающий указание номера одной строки, которую нужно обработать:
```shell
sed '2s/test/another test/' myfile
```

Результат работы скрипта:
```
This is a test.
This is the second another test.
This is the thrid test.
This is the fourth test.
```

Второй вариант — диапазон строк:
```shell
sed '2,3s/test/another test/' myfile
```

Результат работы:
```
This is a test.
This is the second another test.
This is the thrid another test.
This is the fourth test.
```

Кроме того, можно вызвать команду замены так, чтобы файл был обработан начиная с некоей строки и до конца. Для этого используется символ "$":
```shell
sed '2,$s/test/another test/' myfile
```

Результат:
```
This is a test.
This is the second another test.
This is the thrid another test.
This is the fourth another test.
```
